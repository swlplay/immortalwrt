name: Monitor and Build ImmortalWrt (x86_64 Master)1

on:
  # 定时触发：每周二18点检查更新（UTC时间）
  schedule:
    - cron: '0 18 * * 2'
  
  # 代码推送触发：推送到 master 分支时触发
  push:
    branches: [ master ]
  
  # Pull Request 触发：针对 master 分支的 PR 时触发
  pull_request:
    branches: [ master ]
  
  # 手动触发：允许在网页上手动触发
  workflow_dispatch:

env:
  TARGET: x86
  SUBTARGET: 64
  WORKING_DIRECTORY: immortalwrt-x86
  CONFIG_HISTORY_DIR: config-x86-64-history

jobs:
  check-and-build:
    runs-on: ubuntu-latest
    container:
      image: debian:11
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # 确保拉取所有分支和历史，以便后续推送
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Debug Git environment
      run: |
        echo "=== 环境信息 ==="
        echo "工作目录: $(pwd)"
        echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
        echo "=== 目录结构 ==="
        ls -la
        echo "=== 查找 Git ==="
        find . -name ".git" -type d 2>/dev/null | head -10
        echo "=== Git 命令测试 ==="
        git status 2>&1 || echo "Git 命令失败"
        echo "=== 结束调试 ==="  
